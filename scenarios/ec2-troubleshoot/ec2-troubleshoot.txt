AWSTemplateFormatVersion: "2010-09-09"
Description: "EC2 Troubleshooting Scenario - Simulates connectivity issue for cloud support portfolio"

Resources:

  # Security Group with no inbound HTTP (simulate issue)
  EC2SecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: "Security group for EC2 troubleshooting portfolio"
      VpcId: !Ref DefaultVPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0  # Allow SSH
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0

  # EC2 Instance
  EC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.micro
      ImageId: ami-0c02fb55956c7d316   # Amazon Linux 2 in us-east-1 (update if region differs)
      KeyName: my-key                 # Replace with your SSH key
      SecurityGroupIds:
        - !Ref EC2SecurityGroup
      Tags:
        - Key: Name
          Value: EC2-Troubleshoot-Portfolio

# Outputs for easy access
Outputs:
  EC2PublicIP:
    Description: "Public IP of EC2 instance"
    Value: !GetAtt EC2Instance.PublicIp

  SecurityGroupID:
    Description: "Security Group ID"
    Value: !Ref EC2SecurityGroup

Parameters:
  DefaultVPC:
    Type: AWS::EC2::VPC::Id
    Description: "The VPC ID to launch resources in"
